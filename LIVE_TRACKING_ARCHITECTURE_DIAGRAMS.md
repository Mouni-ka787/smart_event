# Live Tracking System Architecture & Flow Diagrams

## ðŸ—ï¸ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SMARTEVENTX LIVE TRACKING                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚         â”‚                  â”‚         â”‚                  â”‚
â”‚   USER DEVICE    â”‚         â”‚  VENDOR DEVICE   â”‚         â”‚  ADMIN PORTAL    â”‚
â”‚   (Browser)      â”‚         â”‚   (Browser)      â”‚         â”‚   (Browser)      â”‚
â”‚                  â”‚         â”‚                  â”‚         â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚                            â”‚
         â”‚ HTTPS + WebSocket          â”‚ HTTPS + WebSocket          â”‚ HTTPS
         â”‚                            â”‚                            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                                â”‚
                      â–¼                                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         NEXT.JS FRONTEND (Port 3000)               â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Components:                                 â”‚  â”‚
         â”‚  â”‚  â€¢ MapComponent (Google Maps)                â”‚  â”‚
         â”‚  â”‚  â€¢ VendorTracking (Location sender)          â”‚  â”‚
         â”‚  â”‚  â€¢ SimpleTracking (Location viewer)          â”‚  â”‚
         â”‚  â”‚  â€¢ TrackingModal                             â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Services:                                   â”‚  â”‚
         â”‚  â”‚  â€¢ WebSocket Service (Real-time)             â”‚  â”‚
         â”‚  â”‚  â€¢ API Service (REST)                        â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ REST API                  â”‚ WebSocket
                      â”‚                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        EXPRESS.JS BACKEND (Port 5000)              â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Controllers:                                â”‚  â”‚
         â”‚  â”‚  â€¢ locationController (Location APIs)        â”‚  â”‚
         â”‚  â”‚  â€¢ bookingController (Booking APIs)          â”‚  â”‚
         â”‚  â”‚  â€¢ vendorController (Vendor APIs)            â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  WebSocket Server:                           â”‚  â”‚
         â”‚  â”‚  â€¢ Socket.IO (Real-time events)              â”‚  â”‚
         â”‚  â”‚  â€¢ Room management (per booking)             â”‚  â”‚
         â”‚  â”‚  â€¢ Event broadcasting                        â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Utils:                                      â”‚  â”‚
         â”‚  â”‚  â€¢ locationUtils (Distance/ETA calc)         â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            MONGODB DATABASE                        â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Collections:                                â”‚  â”‚
         â”‚  â”‚  â€¢ bookings (with trackingInfo)              â”‚  â”‚
         â”‚  â”‚  â€¢ users (vendors & customers)               â”‚  â”‚
         â”‚  â”‚  â€¢ services                                  â”‚  â”‚
         â”‚  â”‚  â€¢ events                                    â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Indexes:                                    â”‚  â”‚
         â”‚  â”‚  â€¢ 2dsphere (geospatial queries)             â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         GOOGLE MAPS API (External)                 â”‚
         â”‚  â€¢ Maps JavaScript API                             â”‚
         â”‚  â€¢ Geocoding API                                   â”‚
         â”‚  â€¢ Directions API (optional)                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Complete Booking & Tracking Flow

### **Flow 1: Booking Creation**

```
USER                    FRONTEND               BACKEND              DATABASE
 â”‚                         â”‚                      â”‚                    â”‚
 â”‚ 1. Fill booking form   â”‚                      â”‚                    â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                    â”‚
 â”‚                         â”‚                      â”‚                    â”‚
 â”‚                         â”‚ 2. POST /api/bookingsâ”‚                    â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
 â”‚                         â”‚   {                  â”‚                    â”‚
 â”‚                         â”‚     service,         â”‚                    â”‚
 â”‚                         â”‚     vendor,          â”‚                    â”‚
 â”‚                         â”‚     venueLocation: { â”‚                    â”‚
 â”‚                         â”‚       address,       â”‚                    â”‚
 â”‚                         â”‚       coordinates    â”‚                    â”‚
 â”‚                         â”‚     }                â”‚                    â”‚
 â”‚                         â”‚   }                  â”‚                    â”‚
 â”‚                         â”‚                      â”‚ 3. Save booking    â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                      â”‚                    â”‚
 â”‚                         â”‚                      â”‚ 4. Booking created â”‚
 â”‚                         â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                         â”‚ 5. Booking response  â”‚                    â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
 â”‚ 6. Confirmation shown  â”‚                      â”‚                    â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                    â”‚
```

### **Flow 2: Vendor Accepts Booking**

```
VENDOR                  FRONTEND               BACKEND              DATABASE
 â”‚                         â”‚                      â”‚                    â”‚
 â”‚ 1. View bookings       â”‚                      â”‚                    â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                    â”‚
 â”‚                         â”‚ 2. GET /api/bookings â”‚                    â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
 â”‚                         â”‚                      â”‚ 3. Fetch bookings  â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                         â”‚ 4. Bookings list     â”‚                    â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
 â”‚ 5. Click "Accept"      â”‚                      â”‚                    â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                    â”‚
 â”‚                         â”‚ 6. PUT /bookings/:id/accept              â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
 â”‚                         â”‚                      â”‚ 7. Update status   â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                      â”‚    status='confirmed'
 â”‚                         â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                         â”‚ 8. Success response  â”‚                    â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
 â”‚ 9. "Accepted" shown    â”‚                      â”‚                    â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                    â”‚
```

### **Flow 3: Start Live Tracking**

```
VENDOR                  FRONTEND               BACKEND         WEBSOCKET        DATABASE
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚ 1. Click "Start        â”‚                      â”‚                â”‚               â”‚
 â”‚    Tracking"           â”‚                      â”‚                â”‚               â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚ 2. Get current GPS  â”‚                â”‚               â”‚
 â”‚                         â”‚    location          â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚ 3. POST /location/   â”‚                â”‚               â”‚
 â”‚                         â”‚    bookings/:id/     â”‚                â”‚               â”‚
 â”‚                         â”‚    start-tracking    â”‚                â”‚               â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚
 â”‚                         â”‚   {startLocation}    â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚ 4. Update DB   â”‚               â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                      â”‚                â”‚   status=     â”‚
 â”‚                         â”‚                      â”‚                â”‚   'in_progress'
 â”‚                         â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚ 5. Emit status â”‚               â”‚
 â”‚                         â”‚                      â”‚   update       â”‚               â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                         â”‚                      â”‚   'EN_ROUTE'   â”‚               â”‚
 â”‚                         â”‚ 6. Success response  â”‚                â”‚               â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚ 7. Start GPS watch   â”‚                â”‚               â”‚
 â”‚                         â”‚    (every 5-10s)     â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
```

### **Flow 4: Real-time Location Updates**

```
VENDOR                  FRONTEND               BACKEND         WEBSOCKET        USER
(Sending location)      (Vendor app)           (Server)        (Server)        (Tracking)
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚ GPS update every 5s    â”‚                      â”‚                â”‚               â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚ 1. POST /vendors/    â”‚                â”‚               â”‚
 â”‚                         â”‚    :id/location      â”‚                â”‚               â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚
 â”‚                         â”‚   {                  â”‚                â”‚               â”‚
 â”‚                         â”‚     bookingId,       â”‚                â”‚               â”‚
 â”‚                         â”‚     lat, lng,        â”‚                â”‚               â”‚
 â”‚                         â”‚     speed, bearing   â”‚                â”‚               â”‚
 â”‚                         â”‚   }                  â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚ 2. Calculate   â”‚               â”‚
 â”‚                         â”‚                      â”‚    ETA         â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚ 3. Update DB   â”‚               â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚ 4. Broadcast   â”‚               â”‚
 â”‚                         â”‚                      â”‚    to room     â”‚               â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚ 5. location:  â”‚
 â”‚                         â”‚                      â”‚                â”‚    update     â”‚
 â”‚                         â”‚                      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                      â”‚                â”‚   {lat, lng,  â”‚
 â”‚                         â”‚                      â”‚                â”‚    etaSeconds}â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚ 6. Update map â”‚
 â”‚                         â”‚                      â”‚                â”‚    & ETA      â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
```

### **Flow 5: User Monitoring Live Tracking**

```
USER                    FRONTEND               WEBSOCKET         BACKEND
 â”‚                         â”‚                      â”‚                 â”‚
 â”‚ 1. Open tracking page  â”‚                      â”‚                 â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                 â”‚
 â”‚                         â”‚ 2. Connect to WS     â”‚                 â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
 â”‚                         â”‚   {token}            â”‚                 â”‚
 â”‚                         â”‚                      â”‚ 3. Authenticate â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                         â”‚ 4. Connected         â”‚                 â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
 â”‚                         â”‚                      â”‚                 â”‚
 â”‚                         â”‚ 5. Join booking room â”‚                 â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
 â”‚                         â”‚   {bookingId}        â”‚                 â”‚
 â”‚                         â”‚                      â”‚                 â”‚
 â”‚                         â”‚ 6. Joined confirmation                 â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
 â”‚                         â”‚                      â”‚                 â”‚
 â”‚                         â”‚ 7. GET /bookings/    â”‚                 â”‚
 â”‚                         â”‚    :id/tracking      â”‚                 â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                      â”‚                 â”‚
 â”‚                         â”‚ 8. Current tracking data               â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                         â”‚   {currentLocation,  â”‚                 â”‚
 â”‚                         â”‚    estimatedArrival} â”‚                 â”‚
 â”‚ 9. Map initialized     â”‚                      â”‚                 â”‚
 â”‚    with vendor &       â”‚                      â”‚                 â”‚
 â”‚    venue markers       â”‚                      â”‚                 â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                 â”‚
 â”‚                         â”‚                      â”‚                 â”‚
 â”‚                         â”‚ 10. Receive real-time updates          â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
 â”‚                         â”‚    location:update   â”‚                 â”‚
 â”‚                         â”‚                      â”‚                 â”‚
 â”‚ 11. Vendor marker      â”‚                      â”‚                 â”‚
 â”‚     moves on map       â”‚                      â”‚                 â”‚
 â”‚     ETA updates        â”‚                      â”‚                 â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                 â”‚
```

### **Flow 6: Vendor Arrives & Completes Service**

```
VENDOR                  FRONTEND               BACKEND         WEBSOCKET        USER
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚ 1. Click "Mark         â”‚                      â”‚                â”‚               â”‚
 â”‚    Arrived"            â”‚                      â”‚                â”‚               â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚ 2. POST /location/   â”‚                â”‚               â”‚
 â”‚                         â”‚    bookings/:id/     â”‚                â”‚               â”‚
 â”‚                         â”‚    stop-tracking     â”‚                â”‚               â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚
 â”‚                         â”‚   {reason:'ARRIVED'} â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚ 3. Update DB   â”‚               â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚ 4. Broadcast   â”‚               â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                         â”‚                      â”‚   'ARRIVED'    â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚ 5. Status     â”‚
 â”‚                         â”‚                      â”‚                â”‚    update     â”‚
 â”‚                         â”‚                      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚ 6. Success           â”‚                â”‚               â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚  "Vendor      â”‚
 â”‚ "Arrived" shown        â”‚                      â”‚                â”‚   Arrived"    â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚ 7. Perform service     â”‚                      â”‚                â”‚               â”‚
 â”‚    ...                 â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚ 8. Click "Complete     â”‚                      â”‚                â”‚               â”‚
 â”‚    Service"            â”‚                      â”‚                â”‚               â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚ 9. POST /location/   â”‚                â”‚               â”‚
 â”‚                         â”‚    bookings/:id/     â”‚                â”‚               â”‚
 â”‚                         â”‚    stop-tracking     â”‚                â”‚               â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚
 â”‚                         â”‚   {reason:'COMPLETED'}                â”‚               â”‚
 â”‚                         â”‚                      â”‚10. Update DB   â”‚               â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                         â”‚                      â”‚ status=        â”‚               â”‚
 â”‚                         â”‚                      â”‚ 'completed'    â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚11. Broadcast   â”‚               â”‚
 â”‚                         â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                         â”‚                      â”‚  'COMPLETED'   â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚12. Status     â”‚
 â”‚                         â”‚                      â”‚                â”‚    update     â”‚
 â”‚                         â”‚                      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚13. Success           â”‚                â”‚               â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚  "Service     â”‚
 â”‚ "Completed" shown      â”‚                      â”‚                â”‚   Completed"  â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                â”‚               â”‚
 â”‚                         â”‚                      â”‚                â”‚               â”‚
 â”‚ 14. QR Code available  â”‚                      â”‚                â”‚15. Can releaseâ”‚
 â”‚     for scanning       â”‚                      â”‚                â”‚    payment    â”‚
```

---

## ðŸ—ºï¸ Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LOCATION DATA FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Vendor Device (GPS)
         â”‚
         â”‚ navigator.geolocation.watchPosition()
         â”‚
         â–¼
  {lat, lng, speed, heading}
         â”‚
         â”‚
         â–¼
  VendorTracking Component
         â”‚
         â”‚ WebSocketService.sendLocationUpdate()
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚              â”‚
         â–¼              â–¼              â–¼
   WebSocket        REST API      Local State
   (Real-time)      (Fallback)    (UI Update)
         â”‚              â”‚
         â”‚              â”‚
         â–¼              â–¼
   Socket.IO â”€â”€â”€â”€> locationController.updateVendorLocation()
   Server                â”‚
         â”‚               â”‚
         â”‚               â–¼
         â”‚         Calculate ETA
         â”‚         (using locationUtils)
         â”‚               â”‚
         â”‚               â–¼
         â”‚         Update MongoDB
         â”‚         (trackingInfo.currentLocation)
         â”‚               â”‚
         â”‚               â–¼
         â”‚         Broadcast to room
         â”‚               â”‚
         â–¼               â–¼
   'location:update' event
         â”‚
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚             â”‚             â”‚
         â–¼             â–¼             â–¼             â–¼
     User 1        User 2        Admin        Vendor
   (Browser)     (Browser)     (Browser)    (Browser)
         â”‚             â”‚             â”‚             â”‚
         â”‚             â”‚             â”‚             â”‚
         â–¼             â–¼             â–¼             â–¼
   MapComponent  MapComponent  Dashboard    Confirmation
   updates       updates       tracking     feedback
   marker        marker        view         
```

---

## ðŸ“Š Database Schema for Tracking

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BOOKING DOCUMENT                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

{
  _id: ObjectId("..."),
  user: ObjectId("userId"),
  service: ObjectId("serviceId"),
  vendor: ObjectId("vendorId"),
  eventName: "Wedding Reception",
  eventDate: ISODate("2025-12-15T18:00:00Z"),
  status: "in_progress",
  paymentStatus: "paid",
  
  // VENUE LOCATION (Where vendor needs to go)
  venueLocation: {
    address: "Grand Ballroom, 456 Park Ave, NY 10001",
    coordinates: {
      lat: 40.7589,
      lng: -73.9851
    }
  },
  
  // TRACKING INFO (Real-time tracking data)
  trackingInfo: {
    // Current vendor location (updates every 5-10 seconds)
    currentLocation: {
      type: "Point",
      coordinates: [-73.9950, 40.7350] // [lng, lat] for MongoDB
    },
    
    // Estimated arrival time (calculated from distance & speed)
    estimatedArrival: ISODate("2025-12-15T17:45:00Z"),
    
    // Status update history
    updates: [
      {
        status: "ACCEPTED",
        timestamp: ISODate("2025-12-15T16:00:00Z"),
        description: "Vendor accepted the booking"
      },
      {
        status: "EN_ROUTE",
        timestamp: ISODate("2025-12-15T16:30:00Z"),
        description: "Vendor started traveling to venue"
      },
      {
        status: "location_update",
        timestamp: ISODate("2025-12-15T16:35:00Z"),
        description: "Location updated to 40.7350, -73.9950"
      },
      // ... more updates
    ]
  },
  
  createdAt: ISODate("2025-12-10T10:00:00Z"),
  updatedAt: ISODate("2025-12-15T16:35:00Z")
}
```

---

## ðŸŽ¯ Status State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BOOKING STATUS FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         [User creates booking]
                  â”‚
                  â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ PENDING  â”‚ â—„â”€â”€â”
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚ Vendor can decline
                 â”‚          â”‚
   [Vendor accepts]         â”‚
                 â”‚          â”‚
                 â–¼          â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
            â”‚CONFIRMED â”‚â”€â”€â”€â”€â”˜
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚
   [Vendor starts tracking]
                 â”‚
                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚IN_PROGRESSâ”‚â”€â”€â”€â”€â”€â”€>â”‚   ARRIVED    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                     â”‚
                 â”‚      [Vendor completes service]
                 â”‚                     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚COMPLETED â”‚
                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                          â”‚
              [User releases payment]
                          â”‚
                          â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ RELEASED â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Alternative paths:
  PENDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> CANCELLED (User/Vendor cancels)
  CONFIRMED â”€â”€â”€â”€â”€â”€â”€â”€> CANCELLED
  ANY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> REFUNDED (After payment, if needed)
```

---

## ðŸŒ WebSocket Events Reference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WEBSOCKET EVENTS                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CLIENT EMITS (Sent from frontend to server):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. join:booking
   Payload: { bookingId: string }
   Purpose: Join a specific booking's room for updates

2. join:event
   Payload: { eventId: string }
   Purpose: Join an event's room for updates

3. location:update
   Payload: {
     assignmentId: string,
     bookingId: string,
     vendorId: string,
     lat: number,
     lng: number,
     speed?: number,
     bearing?: number,
     ts: string,
     etaSeconds?: number
   }
   Purpose: Send location update from vendor

4. assignment:status
   Payload: {
     assignmentId: string,
     bookingId: string,
     status: string
   }
   Purpose: Update booking status


SERVER EMITS (Sent from server to frontend):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. joined:booking
   Payload: { bookingId: string }
   Purpose: Confirmation that client joined booking room

2. joined:event
   Payload: { eventId: string }
   Purpose: Confirmation that client joined event room

3. location:update
   Payload: {
     assignmentId: string,
     bookingId: string,
     vendorId: string,
     lat: number,
     lng: number,
     speed?: number,
     bearing?: number,
     ts: string,
     etaSeconds?: number
   }
   Purpose: Broadcast location update to all room members

4. assignment:status
   Payload: {
     assignmentId: string,
     status: string
   }
   Purpose: Broadcast status update

5. eta:update
   Payload: {
     assignmentId: string,
     etaSeconds: number
   }
   Purpose: Broadcast ETA update

6. error
   Payload: {
     code: string,
     message: string
   }
   Purpose: Send error information


CONNECTION FLOW:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Client                          Server
  â”‚                              â”‚
  â”‚â”€â”€â”€â”€ connect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     {auth: {token}}          â”‚
  â”‚                              â”‚â”€â”€ Verify JWT
  â”‚                              â”‚
  â”‚<â”€â”€â”€ connect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚     (connection established) â”‚
  â”‚                              â”‚
  â”‚â”€â”€â”€â”€ join:booking â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     {bookingId}              â”‚
  â”‚                              â”‚â”€â”€ socket.join(room)
  â”‚                              â”‚
  â”‚<â”€â”€â”€ joined:booking â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚     {bookingId}              â”‚
  â”‚                              â”‚
  â”‚â”€â”€â”€â”€ location:update â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     {lat, lng, ...}          â”‚
  â”‚                              â”‚â”€â”€ Broadcast to room
  â”‚                              â”‚
  â”‚<â”€â”€â”€ location:update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ (all room members)
  â”‚     {lat, lng, ...}          â”‚
```

---

## ðŸ“ ETA Calculation Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ETA CALCULATION PROCESS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input:
  â€¢ Vendor current location (lat1, lng1)
  â€¢ Venue location (lat2, lng2)
  â€¢ Vendor speed (m/s) [optional]

Step 1: Calculate Distance (Haversine Formula)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const R = 6371e3; // Earth radius in meters
  const Ï†1 = lat1 * Math.PI / 180;
  const Ï†2 = lat2 * Math.PI / 180;
  const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
  const Î”Î» = (lng2 - lng1) * Math.PI / 180;

  const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
            Math.cos(Ï†1) * Math.cos(Ï†2) *
            Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
  
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  const distance = R * c; // in meters

Step 2: Calculate ETA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  If speed available:
    etaSeconds = distance / speed
  
  Else (use default urban speed):
    avgSpeed = 10 m/s (36 km/h)
    etaSeconds = distance / avgSpeed

Step 3: Add to Current Time
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  estimatedArrival = now + (etaSeconds * 1000)

Output:
  â€¢ distance (meters)
  â€¢ etaSeconds (seconds)
  â€¢ estimatedArrival (ISO timestamp)

Example:
â”€â”€â”€â”€â”€â”€â”€â”€
  Vendor at: (40.7128, -74.0060) // Times Square, NYC
  Venue at:  (40.7589, -73.9851) // Central Park
  Speed:     15 m/s (54 km/h)

  Distance:  ~5.8 km = 5800 meters
  ETA:       5800 / 15 = 387 seconds â‰ˆ 6.5 minutes
  Arrival:   Current time + 6.5 minutes
```

---

This comprehensive diagram document provides a visual understanding of the entire live tracking system!
